#!/bin/bash
# NOTE We use Feature Tool ( https://bitbucket.org/ogstudio/feature-tool )
# NOTE to generate different versions from the same source code

DIR=`dirname $0`
FEATURES_FILENAME=Features.txt

# List of examples.
EXAMPLES="
01.EmbedResource
02.TextureImage
03.RemoteDebugging
"

# Platform -> Path to Features.txt
declare -A PLATFORMS
PLATFORMS["android"]="app/src/main/cpp"
PLATFORMS["desktop"]="src"
PLATFORMS["ios"]="src"
PLATFORMS["web"]="src"

processPlatformFeatures()
{
    PATH_TO_FEATURES_FILENAME=$1
    FEATURES_FILENAME=$2
    PATH_TO_FEATURES=$3
    SUBDIR=$4

    PATH_TO_FEATURES_TXT=$PATH_TO_FEATURES_FILENAME/$FEATURES_FILENAME

    # If SUBDIR is non-empty.
    if [ ! -z $SUBDIR ]; then
        PATH_TO_FEATURES=$PATH_TO_FEATURES/$SUBDIR
        PATH_TO_GEN=$PATH_TO_FEATURES_FILENAME/$SUBDIR
        mkdir -p $PATH_TO_GEN
    fi

    echo "feature-tool $PATH_TO_FEATURES_TXT $PATH_TO_FEATURES $SUBDIR"
    feature-tool $PATH_TO_FEATURES_TXT $PATH_TO_FEATURES $SUBDIR
}

main()
{
    for example in $EXAMPLES; do
        echo "Generating example '$example'"
        for platform in "${!PLATFORMS[@]}"; do
            dirFeatures=${PLATFORMS[$platform]}
            # Default features.
            processPlatformFeatures $DIR/$example/$platform/$dirFeatures Features.txt $DIR/features
            # Network features.
            processPlatformFeatures $DIR/$example/$platform/$dirFeatures Features.txt $DIR/features/network
            # Debug features.
            processPlatformFeatures $DIR/$example/$platform/$dirFeatures Features.txt $DIR/features/debug
            # Log features.
            processPlatformFeatures $DIR/$example/$platform/$dirFeatures Features.txt $DIR/features/log
        done
    done
}

main

